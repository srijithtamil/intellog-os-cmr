<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INTELLOG OS | Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>.panel { display: none; } .active { display: block; }</style>
</head>
<body class="bg-slate-50">
    <script>
        // THIS MUST BE AT THE TOP
        const supabaseUrl = 'https://ycqlverxbwwiofawsklz.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljcWx2ZXJ4Ynd3aW9mYXdza2x6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5NzEyNDgsImV4cCI6MjA4MzU0NzI0OH0.HP_U6hY25ZSemARtjn6ERbpyZEcaPkZkitFFHR1EE30'; //
        const supabase = supabasejs.createClient(supabaseUrl, supabaseKey);
    </script>

    <nav class="bg-blue-900 text-white p-4 flex justify-between shadow-lg">
        <h1 class="text-xl font-bold italic">INTELLOG OS</h1>
        <div class="space-x-4">
            <button onclick="showPanel('owner')" class="hover:text-yellow-400">Truck Owner</button>
            <button onclick="showPanel('client')" class="hover:text-yellow-400">Bidders</button>
            <button onclick="adminLogin()" class="text-yellow-400 font-bold">Admin Portal</button>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <div id="owner" class="panel active bg-white p-8 rounded-xl shadow-md border-t-4 border-blue-600">
            <h2 class="text-2xl mb-6 font-bold">Post Return Trip</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input id="truckNo" placeholder="Truck No" class="border p-3 rounded">
                <input id="maxVol" type="number" placeholder="Volume" class="border p-3 rounded">
                <input id="fromLoc" placeholder="Pickup (Hyd)" class="border p-3 rounded bg-blue-50">
                <input id="toLoc" placeholder="Drop (Mas)" class="border p-3 rounded bg-blue-50">
                <input id="floorPrice" type="number" placeholder="Min Price" class="border p-3 rounded font-bold">
                <input id="deadline" type="datetime-local" class="border p-3 rounded">
            </div>
            <button onclick="listTruck()" class="mt-6 bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-800 transition">List Truck Availability</button>
        </div>
        <div id="client" class="panel bg-white p-8 rounded shadow"><div id="availableTrucksList"></div></div>
        <div id="admin" class="panel bg-white p-8 rounded shadow"><div id="adminBidsView"></div></div>
    </div>

    <script>
        function showPanel(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if (id === 'client') renderClientView();
            if (id === 'admin') renderAdminView();
        }

        async function listTruck() {
            const truckData = {
                truck_no: document.getElementById('truckNo').value,
                volume: parseFloat(document.getElementById('maxVol').value),
                from_loc: document.getElementById('fromLoc').value,
                to_loc: document.getElementById('toLoc').value,
                floor_price: parseFloat(document.getElementById('floorPrice').value),
                deadline: document.getElementById('deadline').value
            };
            const { error } = await supabase.from('trucks').insert([truckData]);
            if (error) { alert("Error: " + error.message); console.log(error); }
            else { alert("Success!"); showPanel('client'); }
        }

        async function renderClientView() {
            const { data: trucks } = await supabase.from('trucks').select('*');
            document.getElementById('availableTrucksList').innerHTML = trucks?.map(t => `
                <div class="border p-4 mb-2 flex justify-between bg-gray-50">
                    <div><b>${t.from_loc} to ${t.to_loc}</b><br>Min: â‚¹${t.floor_price}</div>
                    <button class="bg-green-600 text-white px-4 py-2 rounded">Bid</button>
                </div>
            `).join('') || "No trucks.";
        }
        // ... (admin functions remain the same)
    </script>
</body>
</html>
